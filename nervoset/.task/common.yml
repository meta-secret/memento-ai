version: '3'

tasks:
  prepare_dependencies:
    internal: true
    vars:
      CHEF_IMAGE_NAME: "lukemathwalker/cargo-chef:latest-rust-1.77-bookworm"
    cmds:
      - mkdir -p target/chef
      - |-
        docker run --rm \
          --user=$(id -u) \
          --workdir=/app \
          -v $(pwd)/app:/app \
          -v $(pwd)/target/chef:/chef \
          {{.CHEF_IMAGE_NAME}} \
          cargo chef prepare --recipe-path /chef/recipe.json
